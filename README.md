# Anime Osuume AI (Supabase Edition)

A sleek, interactive web application that leverages the Gemini API to generate personalized anime recommendations. This version uses Supabase for its backend, including authentication and serverless Edge Functions.

## Architecture

This project uses a modern Jamstack architecture:

-   **Frontend**: A React application (served statically).
-   **Backend**: [Supabase](https://supabase.com/)
    -   **Authentication**: Manages users, login, and registration securely.
    -   **Database**: Stores user data and saved recommendations.
    -   **Edge Functions**: Serverless functions handle secure communication with the Google Gemini API, protecting your API key.

This architecture eliminates the need to run and maintain a separate Node.js server. All backend logic is now handled by the Supabase Edge Functions located in the `supabase/functions` directory.

## Setup Instructions

### 1. Supabase Project Setup

1.  **Create a Supabase Account**: If you don't have one, sign up at [supabase.com](https://supabase.com/).
2.  **Create a New Project**: In your Supabase dashboard, create a new project. Save your database password somewhere safe.
3.  **Get Project Credentials**:
    -   Navigate to `Project Settings` > `API`.
    -   You will need your **Project URL** and your `anon` **public** key.

### 2. Frontend Configuration

1.  **Edit `supabaseClient.ts`**:
    -   Open the `supabaseClient.ts` file.
    -   Paste your **Project URL** and `anon` **public** key into the appropriate variables.

### 3. Supabase Edge Function Setup

The Edge Functions are responsible for securely calling the Gemini API and interacting with your database.

1.  **Install Supabase CLI**: You need the Supabase command-line tool to deploy the functions. Follow the installation guide: [Supabase CLI Docs](https://supabase.com/docs/guides/cli/getting-started).

2.  **Login to Supabase CLI**:
    ```bash
    supabase login
    ```

3.  **Link Your Project**: In your project's root directory, link your local project to your remote Supabase project.
    ```bash
    supabase link --project-ref YOUR_PROJECT_ID
    ```
    You can find your `YOUR_PROJECT_ID` in your project's URL (e.g., `https://app.supabase.com/project/YOUR_PROJECT_ID`).

4.  **Set Gemini API Key Secret**: You must set your Gemini API key as a secret so the Edge Function can access it securely. **Do not** hardcode it.
    ```bash
    supabase secrets set GEMINI_API_KEY=your_gemini_api_key_here
    ```

### 4. Database Schema (for Saved Recommendations)

After setting up your project, you need to create a table to store saved recommendations.

1.  Navigate to the **SQL Editor** in your Supabase dashboard.
2.  Click **New query**.
3.  Paste and run the following SQL to create the table and its security policies:

```sql
-- Create the table for saved recommendations
CREATE TABLE public.saved_recommendations (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE NOT NULL,
    created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL,
    recommendations JSONB NOT NULL
);

-- Enable Row Level Security (RLS) on the table
ALTER TABLE public.saved_recommendations ENABLE ROW LEVEL SECURITY;

-- Create policy: Users can insert their own recommendations
CREATE POLICY "Allow users to insert their own saved recommendations"
ON public.saved_recommendations
FOR INSERT WITH CHECK (auth.uid() = user_id);

-- Create policy: Users can view their own recommendations
CREATE POLICY "Allow users to view their own saved recommendations"
ON public.saved_recommendations
FOR SELECT USING (auth.uid() = user_id);
```

### 5. Deploy Edge Functions

This application uses three Edge Functions. Deploy them all using the Supabase CLI:

```bash
# Deploy the main recommendation generator
supabase functions deploy get-recommendations

# Deploy the functions for saving and fetching user history
supabase functions deploy save-recommendations
supabase functions deploy get-saved-recommendations
```

### 6. Running the Frontend Application

1.  **Serve the files**: With the Supabase backend configured and the functions deployed, you just need to serve the static frontend files.
2.  If you have VS Code, the [Live Server](https://marketplace.visualstudio.com/items?itemName=ritwickdey.LiveServer) extension is a great option.
3.  Right-click on `index.html` and select "Open with Live Server".
4.  The application will open in your browser and will now communicate with your live Supabase backend. Registration, login, saving, and recommendations should all work!